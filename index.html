<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FootGuard – Diabetes Foot Health</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:sans-serif;background:#fafafb;color:#333;margin:0;padding:0;}
header{background:#1976d2;color:white;padding:25px;text-align:center;}
nav{display:flex;justify-content:center;background:#1565c0;}
nav button{background:#1565c0;color:white;padding:10px 20px;margin:2px;border:none;cursor:pointer;}
nav button.active, nav button:hover{background:#42a5f5;}
section{display:none;padding:20px;max-width:900px;margin:auto;}
section.active{display:block;}
.chart-container{background:white;padding:20px;border-radius:10px;box-shadow:0 4px 6px rgba(0,0,0,0.1);}
.advice{background:#e3f2fd;padding:15px;margin-top:15px;border-left:5px solid #2196f3;}
</style>
</head>
<body>

<header>
<h1>FootGuard – Diabetes Foot Health Dashboard</h1>
<p>Monitoring plantar pressure for ulcer prevention</p>
</header>

<nav>
<button class="tab-btn active" data-target="home">Home</button>
<button class="tab-btn" data-target="pressure">Pressure Data</button>
<button class="tab-btn" data-target="interpretation">Interpretation</button>
</nav>

<section id="home" class="active">
<h2>Welcome to FootGuard</h2>
<p>FootGuard visualizes plantar pressure for diabetes patients to prevent foot ulcers. Early detection of high-pressure zones can reduce ulceration risk.</p>
</section>

<section id="pressure">
<h2>Live Plantar Pressure</h2>
<div class="chart-container">
<canvas id="pressureChart"></canvas>
</div>
<button onclick="connectBLE()">Connect to Arduino (simulated)</button>
</section>

<section id="interpretation">
<h2>Interpretation & Advice</h2>
<div id="adviceText" class="advice">
<p>No data yet. Simulated readings will appear automatically.</p>
</div>
</section>

<script>
// Tabs
const tabs=document.querySelectorAll('.tab-btn');
tabs.forEach(tab=>tab.addEventListener('click',()=>{
  tabs.forEach(t=>t.classList.remove('active'));
  tab.classList.add('active');
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  document.getElementById(tab.dataset.target).classList.add('active');
}));

// Chart
const ctx=document.getElementById('pressureChart').getContext('2d');
const pressureChart=new Chart(ctx,{
  type:'line',
  data:{labels:[],datasets:[
    {label:'Sensor 1',data:[],borderColor:'rgba(75,192,192,1)',backgroundColor:'rgba(75,192,192,0.2)',tension:0.3},
    {label:'Sensor 2',data:[],borderColor:'rgba(255,99,132,1)',backgroundColor:'rgba(255,99,132,0.2)',tension:0.3}
  ]},
  options:{responsive:true,animation:false,scales:{y:{min:0,max:100},x:{}}}
});

// Pressure history
let pressureHistory=[];
const historyLimit=60;
let simulatedInterval;
let bleConnected=false;

// Simulated data
function startSimulatedData(){
  simulatedInterval=setInterval(()=>{
    if(!bleConnected){
      const s1=Math.floor(Math.random()*100);
      const s2=Math.floor(Math.random()*100);
      addData(s1,s2);
    }
  },500);
}
startSimulatedData();

function addData(s1,s2){
  const time=new Date().toLocaleTimeString();
  pressureChart.data.labels.push(time);
  pressureChart.data.datasets[0].data.push(s1);
  pressureChart.data.datasets[1].data.push(s2);
  if(pressureChart.data.labels.length>50){
    pressureChart.data.labels.shift();
    pressureChart.data.datasets.forEach(d=>d.data.shift());
  }
  pressureChart.update('none');
  pressureHistory.push((s1+s2)/2);
  if(pressureHistory.length>historyLimit) pressureHistory.shift();
}

// Compute stats
function computeStats(){
  if(pressureHistory.length===0) return null;
  const sorted=[...pressureHistory].sort((a,b)=>a-b);
  const mean=pressureHistory.reduce((a,b)=>a+b,0)/pressureHistory.length;
  const p90=sorted[Math.floor(0.9*sorted.length)];
  return {mean,p90};
}

// Generate advice
function generateAdvice(){
  const stats=computeStats();
  if(!stats) return {risk:"No Data",advice:"Waiting for readings..."};
  let risk,advice;
  if(stats.mean<50 && stats.p90<60){risk="Low Risk";advice=`Average pressure ${stats.mean.toFixed(1)}%. Feet are safe.`;}
  else if((stats.mean>=50 && stats.mean<=70)||(stats.p90>=60 && stats.p90<=75)){risk="Moderate Risk";advice=`Moderate pressure detected (mean ${stats.mean.toFixed(1)}%, 90th percentile ${stats.p90.toFixed(1)}%).`;}
  else{risk="High Risk";advice=`High pressure detected (mean ${stats.mean.toFixed(1)}%, 90th percentile ${stats.p90.toFixed(1)}). Consult clinician.`;}
  return {risk,advice};
}

// Update advice every 30s
setInterval(()=>{
  const {risk,advice}=generateAdvice();
  document.getElementById("adviceText").innerHTML=`<h3>${risk}</h3><p>${advice}</p>`;
},30000);

// BLE placeholder
function connectBLE(){
  alert("BLE connection simulated. Replace with Arduino UUIDs for real sensor data.");
  bleConnected=true;
  clearInterval(simulatedInterval);
}
</script>
</body>
</html>
