<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FootGuard Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<style>
/* Modern CSS Reset & Variables */
:root {
  --primary: #2ecc71;
  --primary-dark: #27ae60;
  --secondary: #3498db;
  --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  --card-bg: rgba(255, 255, 255, 0.9);
  --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
}

body { 
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
  background: var(--bg-gradient); 
  background-attachment: fixed;
  margin: 0; 
  padding: 0; 
  color: #2c3e50; 
  min-height: 100vh;
}

header { 
  background: white; 
  color: #333; 
  padding: 40px 20px; 
  text-align: center; 
  box-shadow: var(--shadow);
  border-bottom: 4px solid var(--primary);
}

header h1 { margin: 0; font-size: 2.5em; letter-spacing: -1px; color: #1a1a1a; }
header p { margin: 10px 0 0; opacity: 0.8; font-weight: 300; }

/* Interactive Navigation */
nav { 
  display: flex; 
  justify-content: center; 
  gap: 10px;
  padding: 20px;
  position: sticky;
  top: 0;
  z-index: 100;
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.7);
}

nav button { 
  background: white; 
  border: 1px solid #ddd; 
  padding: 12px 25px; 
  color: #555; 
  cursor: pointer; 
  font-size: 15px; 
  font-weight: 600;
  border-radius: 50px;
  transition: all 0.3s ease;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

nav button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
nav button.active { background: var(--primary); color: white; border-color: var(--primary); }

/* Section Containers */
section { 
  display: none; 
  padding: 40px; 
  max-width: 1000px; 
  margin: 30px auto; 
  background: var(--card-bg);
  border-radius: 20px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(4px);
  border: 1px solid rgba(255, 255, 255, 0.18);
  animation: fadeIn 0.5s ease;
}

section.active { display: block; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

h2 { color: #1a1a1a; border-left: 5px solid var(--primary); padding-left: 15px; margin-bottom: 25px; }

/* Chart Styling */
.chart-container { 
  width: 100%; 
  background: white;
  padding: 20px;
  border-radius: 15px;
  box-sizing: border-box;
  margin-top: 20px;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
}

/* Button & UI Elements */
.connect-btn { 
  padding: 15px 40px; 
  font-size: 16px; 
  background: var(--primary); 
  color: white; 
  border: none; 
  border-radius: 10px;
  cursor: pointer; 
  margin: 15px 0; 
  font-weight: bold;
  text-transform: uppercase;
  transition: background 0.3s;
}

.connect-btn:hover { background: var(--primary-dark); }

p { line-height: 1.8; font-size: 1.1em; color: #444; }

.advice { 
  background: #fff; 
  padding: 25px; 
  margin-top: 20px; 
  border-radius: 15px;
  border-left: 8px solid var(--secondary);
  box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}

strong { color: #2c3e50; }
</style>
</head>
<body>

<header>
<h1>FootGuard</h1>
<p>Diabetic Foot Ulcer (DFU) Risk Monitoring System</p>
</header>

<nav>
<button class="tab-btn active" data-target="landing">Overview</button>
<button class="tab-btn" data-target="pressure">Live Monitoring</button>
<button class="tab-btn" data-target="interpretation">Clinical Advice</button>
</nav>

<div class="main-content">
  <section id="landing" class="active">
  <h2>The Importance of Monitoring</h2>

  <p>
  <strong>Abstract:</strong> Diabetic Foot Ulcers (DFUs) are a leading cause of lower-extremity amputation worldwide.
  Clinical research demonstrates that prolonged elevated plantar pressure, particularly in patients with diabetic
  neuropathy, is a primary biomechanical predictor of ulcer formation.
  </p>

  <p>
  Due to nerve damage and reduced sensation, many individuals with diabetes cannot perceive harmful pressure
  accumulation in the foot. Without intervention, repetitive mechanical stress leads to tissue breakdown,
  infection, and ulceration.
  </p>

  <p>
  FootGuard continuously analyzes plantar pressure patterns to estimate DFU risk using statistically derived
  features validated in peer-reviewed literature. The goal is <strong>early detection, prevention, and risk awareness</strong>.
  </p>
  </section>

  <section id="pressure">
  <h2>Live Plantar Pressure Data</h2>
  <p>Ensure your sensors are positioned correctly before initiating the link.</p>
  <button class="connect-btn" onclick="connectBLE()">Connect FootGuard Device</button>
  <div class="chart-container">
  <canvas id="pressureChart"></canvas>
  </div>
  </section>

  <section id="interpretation">
  <h2>DFU Risk Interpretation</h2>
  <div id="adviceText" class="advice">
  <p>Waiting for telemetry... Please connect the FootGuard device to begin analysis.</p>
  </div>
  </section>
</div>

<script>
// ================= TAB NAVIGATION =================
const tabs = document.querySelectorAll('.tab-btn');
const sections = document.querySelectorAll('section');
tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    tabs.forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    sections.forEach(sec => sec.classList.remove('active'));
    document.getElementById(tab.dataset.target).classList.add('active');
  });
});

// ================= CHART SETUP =================
const ctx = document.getElementById('pressureChart').getContext('2d');
const pressureChart = new Chart(ctx, {
  type:'line',
  data:{
    labels:[],
    datasets:[
      {label:'Medial (Sensor 1)', borderColor:'#3498db', backgroundColor:'rgba(52, 152, 219, 0.1)', data:[], fill: true, tension:0.4},
      {label:'Lateral (Sensor 2)', borderColor:'#e74c3c', backgroundColor:'rgba(231, 76, 60, 0.1)', data:[], fill: true, tension:0.4}
    ]
  },
  options:{
    responsive:true, 
    maintainAspectRatio: false,
    animation: { duration: 0 }, 
    scales:{
      y:{min:0,max:100, grid: { color: '#eee' }, title:{display:true,text:'Pressure %'}}, 
      x:{grid: { display: false }, title:{display:true,text:'Timeline'}}
    },
    plugins: { legend: { position: 'top' } }
  }
});

// ================= STATE =================
let isBLEConnected = false;

// ================= BLE CONNECTION =================
async function connectBLE(){
  try {
    isBLEConnected = true;

    const device = await navigator.bluetooth.requestDevice({
      filters:[{name:'PlantarPressure'}],
      optionalServices:['12345678-1234-1234-1234-123456789abc']
    });

    const server = await device.gatt.connect();
    const service = await server.getPrimaryService('12345678-1234-1234-1234-123456789abc');
    const sensor1Char = await service.getCharacteristic('11111111-1234-1234-1234-123456789abc');
    const sensor2Char = await service.getCharacteristic('22222222-1234-1234-1234-123456789abc');

    await sensor1Char.startNotifications();
    await sensor2Char.startNotifications();

    sensor1Char.addEventListener('characteristicvaluechanged', e=>{
      addDataToChart(e.target.value.getUint8(0), null);
    });

    sensor2Char.addEventListener('characteristicvaluechanged', e=>{
      addDataToChart(null, e.target.value.getUint8(0));
    });

    alert('FootGuard device successfully connected.');
  } catch(error){
    console.error(error);
    alert('BLE connection failed. Running in simulation mode.');
  }
}

// ================= DFU RISK MODEL =================
function extractFeatures(sensor1Data, sensor2Data) {
  const combined = sensor1Data.map((v,i)=> (v + sensor2Data[i]) / 2);
  const mean = combined.reduce((a,b)=>a+b,0) / combined.length;
  const sorted = [...combined].sort((a,b)=>a-b);
  const p90 = sorted[Math.floor(sorted.length * 0.9)];
  const imbalance = Math.abs(sensor1Data.at(-1) - sensor2Data.at(-1));
  return { mean, p90, imbalance };
}

function mlRiskAssessment(features) {
  let score = 0;
  if (features.mean > 55) score += 1;
  if (features.p90 > 70) score += 2;
  if (features.imbalance > 20) score += 1;

  if (score <= 1) return {level:"Low DFU Risk", confidence:0.90};
  if (score === 2) return {level:"Moderate DFU Risk", confidence:0.87};
  return {level:"High DFU Risk", confidence:0.93};
}

function generateClinicalAdvice(result
