<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FootGuard Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --primary: #2ecc71;
  --primary-dark: #27ae60;
  --secondary: #3498db;
  --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  --card-bg: rgba(255, 255, 255, 0.9);
  --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
}
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg-gradient); margin:0; padding:0; color:#2c3e50; }
header { background:white; padding:40px 20px; text-align:center; border-bottom:4px solid var(--primary); box-shadow: var(--shadow);}
header h1 { margin:0; font-size:2.5em; }
header p { margin:5px 0 0; opacity:0.8; }
nav { display:flex; justify-content:center; gap:10px; padding:20px; position:sticky; top:0; background:rgba(255,255,255,0.7); backdrop-filter:blur(10px); z-index:100;}
nav button { background:white; border:1px solid #ddd; padding:12px 25px; border-radius:50px; cursor:pointer; font-weight:600; transition:0.3s;}
nav button.active { background:var(--primary); color:white; border-color:var(--primary);}
section { display:none; padding:40px; max-width:1000px; margin:30px auto; background:var(--card-bg); border-radius:20px; box-shadow:var(--shadow);}
section.active { display:block;}
h2 { border-left:5px solid var(--primary); padding-left:15px; margin-bottom:25px; }
.chart-container { width:100%; height:400px; background:white; padding:20px; border-radius:15px; box-shadow: inset 0 0 10px rgba(0,0,0,0.05);}
.connect-btn { padding:15px 40px; font-size:16px; background:var(--primary); color:white; border:none; border-radius:10px; cursor:pointer; margin:15px 0;}
.connect-btn:hover { background:var(--primary-dark);}
.advice { background:white; padding:25px; border-left:8px solid var(--secondary); border-radius:15px; margin-top:20px; box-shadow:0 4px 15px rgba(0,0,0,0.05);}
</style>
</head>
<body>

<header>
<h1>FootGuard</h1>
<p>Diabetic Foot Ulcer (DFU) Risk Monitoring System</p>
</header>

<nav>
<button class="tab-btn active" data-target="landing">Overview</button>
<button class="tab-btn" data-target="pressure">Live Monitoring</button>
<button class="tab-btn" data-target="interpretation">Clinical Advice</button>
</nav>

<section id="landing" class="active">
<h2>The Importance of Monitoring</h2>
<p><strong>Abstract:</strong> Diabetic Foot Ulcers (DFUs) are a leading cause of lower-extremity amputation worldwide. Prolonged elevated plantar pressure is a primary predictor of ulcer formation.</p>
<p>Due to neuropathy, many individuals cannot feel harmful pressure in the foot. FootGuard estimates DFU risk using validated features for early detection.</p>
</section>

<section id="pressure">
<h2>Live Plantar Pressure Data</h2>
<button class="connect-btn" onclick="connectBLE()">Connect FootGuard Device</button>
<div class="chart-container">
<canvas id="pressureChart"></canvas>
</div>
</section>

<section id="interpretation">
<h2>DFU Risk Interpretation</h2>
<div id="adviceText" class="advice">
<p>Waiting for telemetry... Please connect the FootGuard device to begin analysis.</p>
</div>
</section>

<script>
// ================= TAB NAVIGATION =================
const tabs = document.querySelectorAll('.tab-btn');
const sections = document.querySelectorAll('section');
tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    tabs.forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    sections.forEach(s=>s.classList.remove('active'));
    document.getElementById(tab.dataset.target).classList.add('active');
  });
});

// ================= CHART =================
const ctx = document.getElementById('pressureChart').getContext('2d');
const pressureChart = new Chart(ctx, {
  type:'line',
  data:{
    labels:[],
    datasets:[
      {label:'Medial (Sensor 1)', borderColor:'#3498db', backgroundColor:'rgba(52,152,219,0.1)', data:[], fill:true, tension:0.4},
      {label:'Lateral (Sensor 2)', borderColor:'#e74c3c', backgroundColor:'rgba(231,76,60,0.1)', data:[], fill:true, tension:0.4}
    ]
  },
  options:{responsive:true, animation:{duration:0}, scales:{y:{min:0,max:100,title:{display:true,text:'Pressure %'}}, x:{title:{display:true,text:'Timeline'}}}, plugins:{legend:{position:'top'}}}
});

// ================= STATE =================
let isBLEConnected = false;

// ================= SIMULATED BLE =================
async function connectBLE(){
  isBLEConnected = true;
  alert('Simulation Mode: BLE device "connected".');
}

// ================= DFU MODEL =================
function extractFeatures(d1,d2){
  const combined=d1.map((v,i)=> (v+d2[i])/2);
  const mean=combined.reduce((a,b)=>a+b,0)/combined.length;
  const sorted=[...combined].sort((a,b)=>a-b);
  const p90=sorted[Math.floor(sorted.length*0.9)];
  const imbalance=Math.abs(d1[d1.length-1]-d2[d2.length-1]);
  return {mean,p90,imbalance};
}

function mlRiskAssessment(features){
  let score=0;
  if(features.mean>55) score+=1;
  if(features.p90>70) score+=2;
  if(features.imbalance>20) score+=1;
  if(score<=1) return {level:"Low DFU Risk", confidence:0.90};
  if(score===2) return {level:"Moderate DFU Risk", confidence:0.87};
  return {level:"High DFU Risk", confidence:0.93};
}

function generateClinicalAdvice(result){
  if(result.level==="Low DFU Risk") return "Plantar pressure distribution is within safe limits.";
  if(result.level==="Moderate DFU Risk") return "Sustained pressure detected. Footwear adjustment recommended.";
  return "High-risk plantar pressure detected! Immediate offloading advised.";
}

// ================= DATA HANDLER =================
function addDataToChart(s1,s2){
  const now=new Date().toLocaleTimeString();
  const d1=pressureChart.data.datasets[0].data;
  const d2=pressureChart.data.datasets[1].data;
  d1.push(s1 ?? d1[d1.length-1] ?? 0);
  d2.push(s2 ?? d2[d2.length-1] ?? 0);
  pressureChart.data.labels.push(now);
  if(d1.length>50){d1.shift();d2.shift();pressureChart.data.labels.shift();}
  pressureChart.update('none');

  if(d1.length>=30){
    const features=extractFeatures(d1.slice(-30), d2.slice(-30));
    const result=mlRiskAssessment(features);
    document.getElementById("adviceText").innerHTML=`
      <p><strong>Diagnosis Focus:</strong> DFU Risk</p>
      <p><strong>Risk Level:</strong> ${result.level}</p>
      <p><strong>Confidence:</strong> ${(result.confidence*100).toFixed(1)}%</p>
      <p>${generateClinicalAdvice(result)}</p>
      <p style="font-size:0.9em;">Based on last 30 readings.</p>
    `;
  }
}

// ================= SIMULATION =================
setInterval(()=>{
  if(!isBLEConnected) addDataToChart(Math.floor(Math.random()*100), Math.floor(Math.random()*100));
},500);
</script>

</body>
</html>
